This is a function to help with basic feature engineering for an unsupervised isolation forest model. The function does this by creating a model for the base values, a window rolling mean, and a model combining the rolling means with a delta column. The window sizes are user defined and can be a singular window size or multiple windows for comparison. The inputs for the function are a pandas column of time series data, either a column of date time or a pandas datetimeindex, and a list of integers for the rolling windows. The outputs are a graph for each of the isolation forests and a dataframe with a column for the isolation forest’s scores for each data point, if the model classifies the data as an anomaly or not, a column for the values input into the isolation forest (such as the rolling window), and a column for the date time input. The graphs outputted are labelled blue line plots, with red circles indicating where the anomalies are; the x and y axis labels are an optional argument for the function.

Using rolling means is a common technique that can be used for things such as reducing noise in the data. However, using only the rolling mean values for anomaly detection would result in only the highest and lowest values being flagged. Using the column for delta allows for picking up abnormal patterns in the data as well.

Using more features might produce a better model, but if using an isolation forest the primary objective is fast computation, even more so than normal. That’s why isolation forest was created, to be a faster alternative to clustering. Using a rolling mean and a delta value has been a good starting point in being light-weight and can indicate if more features are needed to detect anomalous patterns.


The sample data that I used is the Baltimore City crime data from 2011-2016 located at https://data.world/data-society/city-of-baltimore-crime-data.
